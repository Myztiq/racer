// Generated by CoffeeScript 1.3.3
(function() {
  var Game, b2DebugDraw, b2Vec2, b2World,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  b2Vec2 = Box2D.Common.Math.b2Vec2;

  b2World = Box2D.Dynamics.b2World;

  b2DebugDraw = Box2D.Dynamics.b2DebugDraw;

  Game = (function() {

    function Game() {
      this.reset = __bind(this.reset, this);

      this.update = __bind(this.update, this);

      var debugDraw;
      this.controls = new Controls();
      this.world = new b2World(new b2Vec2(0, 10), true);
      new Track(this.world);
      this.car = new Car(this.world);
      debugDraw = new b2DebugDraw();
      debugDraw.SetSprite(document.getElementById("canvas").getContext("2d"));
      debugDraw.SetDrawScale(30.0);
      debugDraw.SetFillAlpha(0.5);
      debugDraw.SetLineThickness(1.0);
      debugDraw.SetFlags(b2DebugDraw.e_shapeBit | b2DebugDraw.e_jointBit);
      this.world.SetDebugDraw(debugDraw);
      window.setInterval(this.update, 1000 / 60);
    }

    Game.prototype.update = function() {
      var controlStatus;
      controlStatus = this.controls.getControlStatus();
      if (controlStatus.reset.pressed) {
        return this.reset();
      } else {
        this.car.update(controlStatus);
        this.world.Step(1 / 60, 10, 10);
        this.world.DrawDebugData();
        return this.world.ClearForces();
      }
    };

    Game.prototype.reset = function() {
      return this.car.reset();
    };

    return Game;

  })();

  window.Game = Game;

}).call(this);
